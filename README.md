# noiseRPA

## Overview

This repository contains all MATLAB codes used to generate the figures in the manuscript, "Toward Single-Cell Control: Noise-Robust Perfect Adaptation in Biomolecular Systems". The codes are written in **MATLAB R2024a**.

---

## Folder Structure and Description

### `Figure 1`

* **`Fig1.m`**

  * Reproduces panels **Fig. 1b, c, e, f, and g**.
  * By default, it plots the green lines in **Fig. 1e, f**.
  * Setting `mu2 = theta2 = eta2 = d2 = 0` produces the blue lines in **Fig. 1c, d**.
  * Setting all of `mu1, theta1, eta1, k1, mu2, theta2, eta2, d2 = 0` and `p1 = 4.5` produces the gray lines in **Fig. 1c, d, e, f**.

---

### `Figure 2`

* **`Fig2a.m`**

  * Reproduces **Fig. 2a**.

* **`Fig2b.m`**

  * Generates the data for the plot in **Fig. 2b**.
  * Running the script produces a CSV file (e.g., `Fig2b_fano.csv`) with four rows, each corresponding to a different lines in Fig. 2b.

* **`Fig2c.m`**

  * Produces the heatmap for **Fig. 2c**.
  * Requires the presence of a file named `stochastic_simulation_1000` in the same directory.
  * Running this script saves a heat matrix file named `Fig2c_heatmap_ff.mat`.

* **`Fig2c_drawing.m`**

  * Visualizes the heatmap matrices generated by the `Fig2c.m` scripts.

* **Pre-simulated Result Folders**

  * `Fig2c_mn`: Results for blue lines in **Fig. 2c**
---

### `Figure 3`

* **`Fig3a_simulation.m`**

  * Simulates data for the heatmap in **Fig. 3a**.
  * Requires the file `stochastic_simulation_1000` in the same directory.
  * Generates 9 files named `heatmap_ff_eta1_{eta1}_eta2_{eta2}.mat`, saved in the `Fig3a` subfolder.

* **`Fig3b_simulation.m`**

  * Simulates data for the heatmap in **Fig. 3b**.
  * Requires the file `stochastic_simulation_1000`.
  * Generates 9 files named `heatmap_ff_k1_{k1}_d2_{d2}.mat`, saved in the `Fig3b` subfolder.

* **`Fig3c_simulation.m`**

  * Simulates data for the heatmap in **Fig. 3c**.
  * Requires the file `stochastic_simulation_on2`.
  * Saves the matrix as `Fig3c_heatmap_ff.mat`.

* **`Fig3d_simulation.m`**

  * Simulates data for the heatmap in **Fig. 3d**.
  * Requires the file `stochastic_simulation_on3`.
  * Saves the matrix as `Fig3d_heatmap_ff.mat`.

* **`Fig3_drawing.m`**

  * Visualizes the heatmap matrices generated by the `_simulation.m` scripts.

* **Pre-simulated Result Folders**

  * `Fig3a_mn`: Results for blue lines in **Fig. 3a**
  * `Fig3b_mn`: Results for blue lines in **Fig. 3b**
  * `Fig3c_mn`: Results for blue lines in **Fig. 3c**
  * `Fig3d_mn`: Results for blue lines in **Fig. 3d**

---

### `Figure 4`

* **`Fig4_telegraph.m`**

  * Simulates and draws plots in **Fig. 4b-c**.
  * Generates 3 files named `telegraph.mat`, `telegraph_MC.mat`, `telegraph_MC_NC.mat`.
    
* **`Fig4_toggle_switch.m`**

  * Simulates and draws plots in **Fig. 4e-f**.
  * Generates 3 files named `toggle_switch.mat`, `toggle_switch_MC.mat`, `toggle_switch_MC_NC.mat`.

* **Pre-simulated Result Folders**

  * `telegraph`: Simulation results of the telegraph model used in **Fig. 4b-c**
  * `telegraph_MC`: Simulation results of the telegraph model with MC used in **Fig. 4b-c**
  * `telegraph_MC_NC`: Simulation results of the telegraph model with MC and NC used in **Fig. 4b-c**
  * `toggle_switch`: Simulation results of the toggle_switch model used in **Fig. 4e-f**
  * `toggle_switch_MC`: Simulation results of the toggle_switch model with MC used in **Fig. 4e-f**
  * `toggle_switch_MC_NC`: Simulation results of the toggle_switch model with MC and NC used in **Fig. 4e-f**

---

### `Figure 5`

* **`Fig5bc.m`**

  * Plots the histograms shown in **Fig. 5b, c**.

* **`Fig5ef.m`**

  * Plots the histograms shown in **Fig. 5e, f**.

---

## Requirements

* Servers

  * Servers are required for faster simulation
  * `Fig2b.m`, `Fig2c.m`, `Fig3a_simulation.m`, `Fig3b_simulation.m`, `Fig3c_simulation.m`, `Fig3d_simulation.m` were simulated on an Intel Xeon Gold 6348 CPU.
    
* MATLAB R2024a

  * Install time for MATLAB differs by the versions and computing devices, but it typically takes less than 1 hour
    
* The following simulation files must be present in the relevant folders:

  * `stochastic_simulation_1000`
  * `stochastic_simulation_on2`
  * `stochastic_simulation_on3`

* The estimated simulation time: ("normal" computer here means Intel Core i7-6700 CPU): 

  * `Fig1.m`: (with normal computer) < 10 minutes for original network and original network with MC; 1 ~ 2 hours for original network with MC and NC
  * `Fig2a.m`: (with normal computer) less than 20 minutes
  * `Fig2b.m`: (with server) 2 hours
  * `Fig2c.m`: (with server) 7 hours
  * `Fig3a_simulation.m`: (with server) 3-4 days
  * `Fig3b_simulation.m`: (with server) 3-4 days
  * `Fig3c_simulation.m`: (with server) 7 hours
  * `Fig3d_simulation.m`: (with server) 7 hours
  * `Fig4_telegraph.m`: (with server) 5 hours
  * `Fig4_toggle_switch.m`: (with server) 5 hours
